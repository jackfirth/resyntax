<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Resyntax</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="file:///home/runner/work/resyntax/resyntax/main.html" class="tocviewselflink" data-pltdoc="x">Resyntax</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._install%29" class="tocviewlink" data-pltdoc="x">Installation</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._cli%29" class="tocviewlink" data-pltdoc="x">The Resyntax Command-<wbr></wbr>Line Interface</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Refactoring_.Rules_and_.Suites%29" class="tocviewlink" data-pltdoc="x">Refactoring Rules and Suites</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Testing_.Refactoring_.Rules%29" class="tocviewlink" data-pltdoc="x">Testing Refactoring Rules</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.Resyntax%29" class="tocsubseclink" data-pltdoc="x">Resyntax</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._install%29" class="tocsubseclink" data-pltdoc="x">Installation</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._cli%29" class="tocsubseclink" data-pltdoc="x">The Resyntax Command-<wbr></wbr>Line Interface</a></td></tr><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#%28part._.Running_resyntax_analyze%29" class="tocsubseclink" data-pltdoc="x">Running <span class="stt">resyntax analyze</span></a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#%28part._.Running_resyntax_fix%29" class="tocsubseclink" data-pltdoc="x">Running <span class="stt">resyntax fix</span></a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.Refactoring_.Rules_and_.Suites%29" class="tocsubseclink" data-pltdoc="x">Refactoring Rules and Suites</a></td></tr><tr><td><a href="#%28def._%28%28lib._resyntax%2Fbase..rkt%29._refactoring-rule~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">refactoring-<wbr></wbr>rule?</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._resyntax%2Fbase..rkt%29._refactoring-suite~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">refactoring-<wbr></wbr>suite?</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-refactoring-rule%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>refactoring-<wbr></wbr>rule</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-definition-context-refactoring-rule%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>definition-<wbr></wbr>context-<wbr></wbr>refactoring-<wbr></wbr>rule</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-refactoring-suite%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>refactoring-<wbr></wbr>suite</span></span></a></td></tr><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#%28part._.Exercising_.Fine_.Control_.Over_.Comments%29" class="tocsubseclink" data-pltdoc="x">Exercising Fine Control Over Comments</a></td></tr><tr><td><a href="#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7ereplacement%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">~replacement</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7esplicing-replacement%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">~splicing-<wbr></wbr>replacement</span></span></a></td></tr><tr><td><span class="tocsublinknumber">3.2<tt>&nbsp;</tt></span><a href="#%28part._.Narrowing_the_.Focus_of_.Replacements%29" class="tocsubseclink" data-pltdoc="x">Narrowing the Focus of Replacements</a></td></tr><tr><td><a href="#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7efocus-replacement-on%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">~focus-<wbr></wbr>replacement-<wbr></wbr>on</span></span></a></td></tr><tr><td><span class="tocsublinknumber">3.3<tt>&nbsp;</tt></span><a href="#%28part._.Resyntax_s_.Default_.Rules%29" class="tocsubseclink" data-pltdoc="x">Resyntax&rsquo;s Default Rules</a></td></tr><tr><td><a href="#%28def._%28%28lib._resyntax%2Fdefault-recommendations..rkt%29._default-recommendations%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">default-<wbr></wbr>recommendations</span></span></a></td></tr><tr><td><span class="tocsublinknumber">3.4<tt>&nbsp;</tt></span><a href="#%28part._.What_.Makes_a_.Good_.Refactoring_.Rule_%29" class="tocsubseclink" data-pltdoc="x">What Makes a Good Refactoring Rule?</a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.Testing_.Refactoring_.Rules%29" class="tocsubseclink" data-pltdoc="x">Testing Refactoring Rules</a></td></tr><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#%28part._.Basic_.Test_.Structure%29" class="tocsubseclink" data-pltdoc="x">Basic Test Structure</a></td></tr><tr><td><span class="tocsublinknumber">4.2<tt>&nbsp;</tt></span><a href="#%28part._.Test_.Case_.Types%29" class="tocsubseclink" data-pltdoc="x">Test Case Types</a></td></tr><tr><td><span class="tocsublinknumber">4.2.1<tt>&nbsp;</tt></span><a href="#%28part._.Positive_.Test_.Cases__.Code_.That_.Should_.Be_.Refactored_%29" class="tocsubseclink" data-pltdoc="x">Positive Test Cases (Code That Should Be Refactored)</a></td></tr><tr><td><span class="tocsublinknumber">4.2.2<tt>&nbsp;</tt></span><a href="#%28part._.Negative_.Test_.Cases__.Code_.That_.Should_.Not_.Be_.Refactored_%29" class="tocsubseclink" data-pltdoc="x">Negative Test Cases (Code That Should Not Be Refactored)</a></td></tr><tr><td><span class="tocsublinknumber">4.3<tt>&nbsp;</tt></span><a href="#%28part._.Test_.Options%29" class="tocsubseclink" data-pltdoc="x">Test Options</a></td></tr><tr><td><span class="tocsublinknumber">4.3.1<tt>&nbsp;</tt></span><a href="#%28part._.Line_.Range_.Restrictions%29" class="tocsubseclink" data-pltdoc="x">Line Range Restrictions</a></td></tr><tr><td><span class="tocsublinknumber">4.4<tt>&nbsp;</tt></span><a href="#%28part._.Writing_.Effective_.Tests%29" class="tocsubseclink" data-pltdoc="x">Writing Effective Tests</a></td></tr><tr><td><span class="tocsublinknumber">4.5<tt>&nbsp;</tt></span><a href="#%28part._.Running_.Tests%29" class="tocsubseclink" data-pltdoc="x">Running Tests</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="versionNoNav">8.17</span></div><h2 class="heading"><a name="(part._.Resyntax)"></a><a name="(mod-path._resyntax)"></a>Resyntax<span class="button-group"><a href="#(part._.Resyntax)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h2><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">require</span></span></span><span class="stt"> </span><a href="file:///home/runner/work/resyntax/resyntax/main.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">resyntax</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/resyntax" title="Install this package using `raco pkg install resyntax`"><span class="stt">resyntax</span></a></span></td></tr></table></p><p>Resyntax is a refactoring tool for Racket. The tool can be guided by <a name="(tech._refactoring._rule)"></a><span style="font-style: italic">refactoring rules</span>,
which are macro-like functions defined in terms of <span class="RktSym"><span class="badlink"><span class="RktValLink">syntax-parse</span></span></span> that specify how to search
for and refactor different coding patterns. Resyntax comes with a standard set of refactoring rules
that improve code written in <font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="stt"> </span><font class="badlink"><span class="RktModLink"><span class="RktSym">racket</span></span></font> or
<font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="stt"> </span><font class="badlink"><span class="RktModLink"><span class="RktSym">racket/base</span></span></font>. For example, consider the following program:</p><blockquote class="SCodeFlow"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"my-program.rkt"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="hspace">&nbsp;</span><font class="badlink"><span class="RktModLink"><span class="RktSym">racket/base</span></span></font></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">swap</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">let</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">t</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">unbox</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">set-box!</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">unbox</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">set-box!</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym">t</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote><p>This program uses <span class="RktSym"><span class="badlink"><span class="RktValLink">let</span></span></span> unnecessarily. The <span class="RktSym"><span class="badlink"><span class="RktValLink">let</span></span></span> expression can be replaced with a
<span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span> form, reducing the indentation of the code. Resyntax is capable of detecting and
automatically fixing this issue. Running <span class="stt">resyntax fix --file my-program.rkt</span> rewrites the above
to the following:</p><blockquote class="SCodeFlow"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"my-program.rkt"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="hspace">&nbsp;</span><font class="badlink"><span class="RktModLink"><span class="RktSym">racket/base</span></span></font></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">swap</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">t</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">unbox</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">set-box!</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">unbox</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">set-box!</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym">t</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></blockquote></blockquote><p>To see a list of suggestions that Resyntax would apply, use <span class="stt">resyntax analyze</span> instead of
<span class="stt">resyntax fix</span>. Each suggestion includes an explanation of why the change is being recommended.</p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._install%29" class="toptoclink" data-pltdoc="x">1<span class="hspace">&nbsp;</span>Installation</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._cli%29" class="toptoclink" data-pltdoc="x">2<span class="hspace">&nbsp;</span>The Resyntax Command-Line Interface</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Running_resyntax_analyze%29" class="toclink" data-pltdoc="x">2.1<span class="hspace">&nbsp;</span>Running <span class="stt">resyntax analyze</span></a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Running_resyntax_fix%29" class="toclink" data-pltdoc="x">2.2<span class="hspace">&nbsp;</span>Running <span class="stt">resyntax fix</span></a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Refactoring_.Rules_and_.Suites%29" class="toptoclink" data-pltdoc="x">3<span class="hspace">&nbsp;</span>Refactoring Rules and Suites</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Exercising_.Fine_.Control_.Over_.Comments%29" class="toclink" data-pltdoc="x">3.1<span class="hspace">&nbsp;</span>Exercising Fine Control Over Comments</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Narrowing_the_.Focus_of_.Replacements%29" class="toclink" data-pltdoc="x">3.2<span class="hspace">&nbsp;</span>Narrowing the Focus of Replacements</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Resyntax_s_.Default_.Rules%29" class="toclink" data-pltdoc="x">3.3<span class="hspace">&nbsp;</span>Resyntax&rsquo;s Default Rules</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.What_.Makes_a_.Good_.Refactoring_.Rule_%29" class="toclink" data-pltdoc="x">3.4<span class="hspace">&nbsp;</span>What Makes a Good Refactoring Rule?</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Testing_.Refactoring_.Rules%29" class="toptoclink" data-pltdoc="x">4<span class="hspace">&nbsp;</span>Testing Refactoring Rules</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Basic_.Test_.Structure%29" class="toclink" data-pltdoc="x">4.1<span class="hspace">&nbsp;</span>Basic Test Structure</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Test_.Case_.Types%29" class="toclink" data-pltdoc="x">4.2<span class="hspace">&nbsp;</span>Test Case Types</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Positive_.Test_.Cases__.Code_.That_.Should_.Be_.Refactored_%29" class="toclink" data-pltdoc="x">4.2.1<span class="hspace">&nbsp;</span>Positive Test Cases (Code That Should Be Refactored)</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Negative_.Test_.Cases__.Code_.That_.Should_.Not_.Be_.Refactored_%29" class="toclink" data-pltdoc="x">4.2.2<span class="hspace">&nbsp;</span>Negative Test Cases (Code That Should Not Be Refactored)</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Test_.Options%29" class="toclink" data-pltdoc="x">4.3<span class="hspace">&nbsp;</span>Test Options</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Line_.Range_.Restrictions%29" class="toclink" data-pltdoc="x">4.3.1<span class="hspace">&nbsp;</span>Line Range Restrictions</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Writing_.Effective_.Tests%29" class="toclink" data-pltdoc="x">4.4<span class="hspace">&nbsp;</span>Writing Effective Tests</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28part._.Running_.Tests%29" class="toclink" data-pltdoc="x">4.5<span class="hspace">&nbsp;</span>Running Tests</a></p></td></tr></table><h3 class="heading">1<tt>&nbsp;</tt><a name="(part._install)"></a>Installation<span class="button-group"><a href="#(part._install)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p>Use the Racket package manager to install Resyntax in the installation scope:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">% raco pkg install --installation resyntax</span></p></td></tr></table></p><p>The <span class="stt">--installation</span> flag (shorthand for <span class="stt">--scope installation</span>) installs packages for
all users of a Racket installation, ensuring <span class="stt">resyntax</span> is in your <span class="stt">PATH</span>.</p><p><div class="SIntrapara">e.g.
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">% resyntax analyze --file example.rkt</span></p></td></tr><tr><td><p><span class="stt">resyntax: --- analyzing code ---</span></p></td></tr><tr><td><p><span class="stt">resyntax: --- displaying results ---</span></p></td></tr><tr><td><p><span class="stt">%</span></p></td></tr></table></div></p><h3 class="heading">2<tt>&nbsp;</tt><a name="(part._cli)"></a>The Resyntax Command-Line Interface<span class="button-group"><a href="#(part._cli)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p>Resyntax provides a command-line <span class="stt">resyntax</span> tool for analyzing and refactoring code. The tool has
two commands: <span class="stt">resyntax analyze</span> for analyzing code without changing it, and <span class="stt">resyntax fix</span>
for fixing code by applying Resyntax&rsquo;s suggestions.</p><p>Note that at present, Resyntax is limited in what files it can fix. Resyntax only analyzes files with
the <span class="stt">.rkt</span> extension where <span class="stt">#lang racket/base</span> is the first line in file.</p><h4 class="heading">2.1<tt>&nbsp;</tt><a name="(part._.Running_resyntax_analyze)"></a>Running <span class="stt">resyntax analyze</span><span class="button-group"><a href="#(part._.Running_resyntax_analyze)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>The <span class="stt">resyntax analyze</span> command accepts flags for specifying what modules to analyze. After
analysis, suggestions are printed in the console. Any of the following flags can be specified any
number of times:</p><ul><li><p><span class="stt">--file</span> <span class="sroman">&#8249;<span style="font-style: italic">file-path</span>&#8250;</span> &#8212;<wbr></wbr> A file to anaylze.</p></li><li><p><span class="stt">--directory</span> <span class="sroman">&#8249;<span style="font-style: italic">directory-path</span>&#8250;</span> &#8212;<wbr></wbr> A directory to anaylze, including
subdirectories.</p></li><li><p><span class="stt">--package</span> <span class="sroman">&#8249;<span style="font-style: italic">package-name</span>&#8250;</span> &#8212;<wbr></wbr> An installed package to analyze.</p></li><li><p><span class="stt">--local-git-repository</span> <span class="sroman">&#8249;<span style="font-style: italic">repository-path</span>&#8250;</span> <span class="sroman">&#8249;<span style="font-style: italic">base-ref</span>&#8250;</span> &#8212;<wbr></wbr> A local Git
repository to analyze the changed files of. Only files which have changed relative to
<span class="sroman">&#8249;<span style="font-style: italic">base-ref</span>&#8250;</span> are analyzed. Base references must be given in the form
<span class="stt">remotename/branchname</span>, for example <span class="stt">origin/main</span> or <span class="stt">upstream/my-feature-branch</span>.</p></li><li><p><span class="stt">--refactoring-suite</span> <span class="sroman">&#8249;<span style="font-style: italic">module-path</span>&#8250;</span> <span class="sroman">&#8249;<span style="font-style: italic">suite-name</span>&#8250;</span> &#8212;<wbr></wbr> A
<a href="file:///home/runner/work/resyntax/resyntax/main.html#%28tech._refactoring._suite%29" class="techoutside" data-pltdoc="x"><span class="techinside">refactoring suite</span></a> to use instead of Resyntax&rsquo;s default recommendations. Custom refactoring
suites can be created with <span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-refactoring-suite%29%29" class="RktStxLink" data-pltdoc="x">define-refactoring-suite</a></span>.</p></li></ul><h4 class="heading">2.2<tt>&nbsp;</tt><a name="(part._.Running_resyntax_fix)"></a>Running <span class="stt">resyntax fix</span><span class="button-group"><a href="#(part._.Running_resyntax_fix)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>The <span class="stt">resyntax fix</span> command accepts the same flags as <span class="stt">resyntax analyze</span> for specifying what
modules to fix. After analysis, fixes are applied and a summary is printed.</p><ul><li><p><span class="stt">--file</span> <span class="sroman">&#8249;<span style="font-style: italic">file-path</span>&#8250;</span> &#8212;<wbr></wbr> A file to fix.</p></li><li><p><span class="stt">--directory</span> <span class="sroman">&#8249;<span style="font-style: italic">directory-path</span>&#8250;</span> &#8212;<wbr></wbr> A directory to fix, including
subdirectories.</p></li><li><p><span class="stt">--package</span> <span class="sroman">&#8249;<span style="font-style: italic">package-name</span>&#8250;</span> &#8212;<wbr></wbr> An installed package to fix.</p></li><li><p><span class="stt">--local-git-repository</span> <span class="sroman">&#8249;<span style="font-style: italic">repository-path</span>&#8250;</span> <span class="sroman">&#8249;<span style="font-style: italic">base-ref</span>&#8250;</span> &#8212;<wbr></wbr> A local Git
repository to fix the changed files of. Only files which have changed relative to <span class="sroman">&#8249;<span style="font-style: italic">base-ref</span>&#8250;</span>
are fixed. Base references must be given in the form <span class="stt">remotename/branchname</span>, for example
<span class="stt">origin/main</span> or <span class="stt">upstream/my-feature-branch</span>.</p></li><li><p><span class="stt">--refactoring-suite</span> <span class="sroman">&#8249;<span style="font-style: italic">module-path</span>&#8250;</span> <span class="sroman">&#8249;<span style="font-style: italic">suite-name</span>&#8250;</span> &#8212;<wbr></wbr> A
<a href="file:///home/runner/work/resyntax/resyntax/main.html#%28tech._refactoring._suite%29" class="techoutside" data-pltdoc="x"><span class="techinside">refactoring suite</span></a> to use instead of Resyntax&rsquo;s default recommendations. Custom refactoring
suites can be created with <span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-refactoring-suite%29%29" class="RktStxLink" data-pltdoc="x">define-refactoring-suite</a></span>.</p></li></ul><p>If two suggestions try to fix the same code, one of them will be rejected. At present, the best way to
handle overlapping fixes is to run Resyntax multiple times until no fixes are rejected.</p><h3 class="heading">3<tt>&nbsp;</tt><a name="(part._.Refactoring_.Rules_and_.Suites)"></a><a name="(mod-path._resyntax/base)"></a>Refactoring Rules and Suites<span class="button-group"><a href="#(part._.Refactoring_.Rules_and_.Suites)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">require</span></span></span><span class="stt"> </span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28mod-path._resyntax%2Fbase%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">resyntax/base</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/resyntax" title="Install this package using `raco pkg install resyntax`"><span class="stt">resyntax</span></a></span></td></tr></table></p><p>Resyntax derives its suggestions from <a href="file:///home/runner/work/resyntax/resyntax/main.html#%28tech._refactoring._rule%29" class="techoutside" data-pltdoc="x"><span class="techinside">refactoring rules</span></a>, which can be grouped into a
<a name="(tech._refactoring._suite)"></a><span style="font-style: italic">refactoring suite</span>. Resyntax ships with a default refactoring suite consisting of many rules
that cover various scenarios related to Racket&rsquo;s standard libraries. However, you may also define your
own refactoring suite and rules using the forms below. Knowledge of Racket macros, and of
<span class="RktSym"><span class="badlink"><span class="RktValLink">syntax-parse</span></span></span> in particular, is especially useful for understanding how to create effective
refactoring rules.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._resyntax/base..rkt)._refactoring-rule~3f))"></a><span title="Provided from: resyntax/base | Package: resyntax"><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28def._%28%28lib._resyntax%2Fbase..rkt%29._refactoring-rule~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">refactoring-rule?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">boolean?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">any/c</span></td></tr></table></blockquote></div><div class="SIntrapara">A predicate that recognizes <a href="file:///home/runner/work/resyntax/resyntax/main.html#%28tech._refactoring._rule%29" class="techoutside" data-pltdoc="x"><span class="techinside">refactoring rules</span></a>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._resyntax/base..rkt)._refactoring-suite~3f))"></a><span title="Provided from: resyntax/base | Package: resyntax"><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28def._%28%28lib._resyntax%2Fbase..rkt%29._refactoring-suite~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">refactoring-suite?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">boolean?</span></span></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">any/c</span></td></tr></table></blockquote></div><div class="SIntrapara">A predicate that recognizes <a href="file:///home/runner/work/resyntax/resyntax/main.html#%28tech._refactoring._suite%29" class="techoutside" data-pltdoc="x"><span class="techinside">refactoring suites</span></a>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><table cellspacing="0" cellpadding="0" class="RktBlk RForeground"><tr><td><span class="RktPn">(</span><a name="(form._((lib._resyntax/base..rkt)._define-refactoring-rule))"></a><span title="Provided from: resyntax/base | Package: resyntax"><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-refactoring-rule%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-refactoring-rule</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">id</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:description</span><span class="hspace">&nbsp;</span><span class="RktVar">description</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">parse-option</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">syntax-pattern</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">pattern-directive</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">template</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">description</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><span class="badlink"><span class="RktValLink">string?</span></span></span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Defines a <a href="file:///home/runner/work/resyntax/resyntax/main.html#%28tech._refactoring._rule%29" class="techoutside" data-pltdoc="x"><span class="techinside">refactoring rule</span></a> named <span class="RktVar">id</span>. Refactoring rules are defined in terms of
<span class="RktSym"><span class="badlink"><span class="RktValLink">syntax-parse</span></span></span>. The rule matches syntax objects that match <span class="RktVar">syntax-pattern</span>, and
<span class="RktVar">template</span> is a <span class="RktSym"><span class="badlink"><span class="RktValLink">syntax</span></span></span> template that defines what the matched code is refactored
into. The message in <span class="RktVar">description</span> is presented to the user when Resyntax makes a suggestion
based on the rule. Refactoring rules function roughly like macros defined with
<span class="RktSym"><span class="badlink"><span class="RktValLink">define-syntax-parse-rule</span></span></span>. For example, here is a simple rule that flattens nested
<span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span> expressions:</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-refactoring-rule%29%29" class="RktStxLink" data-pltdoc="x">define-refactoring-rule</a></span><span class="hspace">&nbsp;</span><span class="RktSym">nested-or-to-flat-or</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:description</span><span class="hspace">&nbsp;</span><span class="RktVal">"This nested `or` expression can be flattened."</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:literals</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>Like <span class="RktSym"><span class="badlink"><span class="RktValLink">syntax-parse</span></span></span> and <span class="RktSym"><span class="badlink"><span class="RktValLink">define-syntax-parse-rule</span></span></span>,
<font class="badlink"><span class="techoutside"><span class="techinside">pattern directives</span></span></font> can be used to aid in
defining rules. Here is a rule that uses the <span class="RktPn">#:when</span> directive to only refactor <span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span>
expressions that have a duplicate condition:</p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-refactoring-rule%29%29" class="RktStxLink" data-pltdoc="x">define-refactoring-rule</a></span><span class="hspace">&nbsp;</span><span class="RktSym">or-with-duplicate-subterm</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:description</span><span class="hspace">&nbsp;</span><span class="RktVal">"This `or` expression has a duplicate subterm."</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:literals</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">before</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">a:id</span><span class="hspace">&nbsp;</span><span class="RktSym">between</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">b:id</span><span class="hspace">&nbsp;</span><span class="RktSym">after</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">free-identifier=?</span></span></span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktSym">b</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">before</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">between</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">after</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><table cellspacing="0" cellpadding="0" class="RktBlk RForeground"><tr><td><span class="RktPn">(</span><a name="(form._((lib._resyntax/base..rkt)._define-definition-context-refactoring-rule))"></a><span title="Provided from: resyntax/base | Package: resyntax"><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-definition-context-refactoring-rule%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-definition-context-refactoring-rule</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">id</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:description</span><span class="hspace">&nbsp;</span><span class="RktVar">description</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">parse-option</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">syntax-pattern</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">pattern-directive</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">template</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">description</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><span class="badlink"><span class="RktValLink">string?</span></span></span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Defines a <a href="file:///home/runner/work/resyntax/resyntax/main.html#%28tech._refactoring._rule%29" class="techoutside" data-pltdoc="x"><span class="techinside">refactoring rule</span></a> named <span class="RktVar">id</span>, like <span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-refactoring-rule%29%29" class="RktStxLink" data-pltdoc="x">define-refactoring-rule</a></span>, except
the rule is applied only in
<font class="badlink"><span class="techoutside"><span class="techinside">internal-definition contexts</span></span></font>. The given
<span class="RktVar">syntax-pattern</span> must be a
<font class="badlink"><span class="techoutside"><span class="techinside">proper head pattern</span></span></font>, and it is expected to
match the entire sequence of body forms within the definition context. The output <span class="RktVar">template</span>
of the rule should be a single syntax object containing a sequence of refactored body forms. Like
<span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-refactoring-rule%29%29" class="RktStxLink" data-pltdoc="x">define-refactoring-rule</a></span>, <span class="RktVar">description</span> is used to generate a message presented to the
user, and both <span class="RktVar">parse-option</span> and <span class="RktVar">pattern-directive</span> function the same as they do in
<span class="RktSym"><span class="badlink"><span class="RktValLink">syntax-parse</span></span></span>. For example, here is a simple rule that turns a series of <span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span>
forms unpacking a 2D <span class="RktSym">point</span> structure into a single <span class="RktSym">match-define</span> form:</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">struct</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">point</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><p>&nbsp;</p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-definition-context-refactoring-rule%29%29" class="RktStxLink" data-pltdoc="x">define-definition-context-refactoring-rule</a></span><span class="hspace">&nbsp;</span><span class="RktSym">point-define-to-match-define</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:description</span><span class="hspace">&nbsp;</span><span class="RktVal">"These definitions can be simplified with `match-define`."</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:literals</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">point-x</span><span class="hspace">&nbsp;</span><span class="RktSym">point-y</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">~seq</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">body-before</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x:id</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">point-x</span><span class="hspace">&nbsp;</span><span class="RktSym">pt:id</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">y:id</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">point-y</span><span class="hspace">&nbsp;</span><span class="RktSym">pt2:id</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">body-after</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">free-identifier=?</span></span></span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktSym">pt</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktSym">pt2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">body-before</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">match-define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">point</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">pt</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">body-after</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>Note that by default Resyntax will try to reformat the entire context. To reformat just the forms
being modified, a few additional steps are required. First, use <span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7ereplacement%29%29" class="RktStxLink" data-pltdoc="x">~replacement</a></span> (or
<span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7esplicing-replacement%29%29" class="RktStxLink" data-pltdoc="x">~splicing-replacement</a></span>) to annotate which subpart of the context is being replaced:</p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-definition-context-refactoring-rule%29%29" class="RktStxLink" data-pltdoc="x">define-definition-context-refactoring-rule</a></span><span class="hspace">&nbsp;</span><span class="RktSym">point-define-to-match-define</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:description</span><span class="hspace">&nbsp;</span><span class="RktVal">"These definitions can be simplified with `match-define`."</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:literals</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">point-x</span><span class="hspace">&nbsp;</span><span class="RktSym">point-y</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">~seq</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">body-before</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">~and</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x-def</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x:id</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">point-x</span><span class="hspace">&nbsp;</span><span class="RktSym">pt:id</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">~and</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">y-def</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">y:id</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">point-y</span><span class="hspace">&nbsp;</span><span class="RktSym">pt2:id</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">body-after</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">free-identifier=?</span></span></span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktSym">pt</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktSym">pt2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">body-before</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7ereplacement%29%29" class="RktStxLink" data-pltdoc="x">~replacement</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">match-define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">point</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">pt</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:original-splice</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x-def</span><span class="hspace">&nbsp;</span><span class="RktSym">y-def</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">body-after</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>This ensures that Resyntax will preserve any comments at the end of <span class="RktSym">body-before</span><span class="stt"> </span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span> and the
beginning of <span class="RktSym">body-after</span><span class="stt"> </span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span>. However, that alone doesn&rsquo;t prevent Resyntax from reformatting
the whole context. To do that, use the <span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7efocus-replacement-on%29%29" class="RktStxLink" data-pltdoc="x">~focus-replacement-on</a></span> metafunction, which tells
Resyntax that if <span class="emph">only</span> the focused forms are changed, Resyntax should "shrink" the replacement
it generates down to just those forms and not reformat anything in the replacement syntax object
that&rsquo;s outside of the focused syntax:</p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-definition-context-refactoring-rule%29%29" class="RktStxLink" data-pltdoc="x">define-definition-context-refactoring-rule</a></span><span class="hspace">&nbsp;</span><span class="RktSym">point-define-to-match-define</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:description</span><span class="hspace">&nbsp;</span><span class="RktVal">"These definitions can be simplified with `match-define`."</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:literals</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">point-x</span><span class="hspace">&nbsp;</span><span class="RktSym">point-y</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">~seq</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">body-before</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">~and</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x-def</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">x:id</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">point-x</span><span class="hspace">&nbsp;</span><span class="RktSym">pt:id</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">~and</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">y-def</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">define</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">y:id</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">point-y</span><span class="hspace">&nbsp;</span><span class="RktSym">pt2:id</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">body-after</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">free-identifier=?</span></span></span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktSym">pt</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktSym">pt2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">body-before</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7efocus-replacement-on%29%29" class="RktStxLink" data-pltdoc="x">~focus-replacement-on</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7ereplacement%29%29" class="RktStxLink" data-pltdoc="x">~replacement</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">match-define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">point</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">pt</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:original-splice</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x-def</span><span class="hspace">&nbsp;</span><span class="RktSym">y-def</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">body-after</span><span class="hspace">&nbsp;</span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._resyntax/base..rkt)._define-refactoring-suite))"></a><span title="Provided from: resyntax/base | Package: resyntax"><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-refactoring-suite%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-refactoring-suite</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">id</span><span class="hspace">&nbsp;</span><span class="RktVar">rules-list</span><span class="hspace">&nbsp;</span><span class="RktVar">suites-list</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">rules-list</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:rules</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">rule</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="RktVar">suites-list</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:suites</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">suite</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><blockquote class="SubFlow"><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">rule</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28def._%28%28lib._resyntax%2Fbase..rkt%29._refactoring-rule~3f%29%29" class="RktValLink" data-pltdoc="x">refactoring-rule?</a></span></td></tr></table><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">suite</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28def._%28%28lib._resyntax%2Fbase..rkt%29._refactoring-suite~3f%29%29" class="RktValLink" data-pltdoc="x">refactoring-suite?</a></span></td></tr></table></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Defines a <a href="file:///home/runner/work/resyntax/resyntax/main.html#%28tech._refactoring._suite%29" class="techoutside" data-pltdoc="x"><span class="techinside">refactoring suite</span></a> named <span class="RktVar">id</span> containing each listed <span class="RktVar">rule</span>.
Additionally, each <span class="RktVar">suite</span> provided has its rules added to the newly defined suite.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-refactoring-suite%29%29" class="RktStxLink" data-pltdoc="x">define-refactoring-suite</a></span><span class="hspace">&nbsp;</span><span class="RktSym">my-suite</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:rules</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rule1</span><span class="hspace">&nbsp;</span><span class="RktSym">rule2</span><span class="hspace">&nbsp;</span><span class="RktSym">rule3</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:suites</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subsuite1</span><span class="hspace">&nbsp;</span><span class="RktSym">subsuite2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><h4 class="heading">3.1<tt>&nbsp;</tt><a name="(part._.Exercising_.Fine_.Control_.Over_.Comments)"></a>Exercising Fine Control Over Comments<span class="button-group"><a href="#(part._.Exercising_.Fine_.Control_.Over_.Comments)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>Writing a rule with <span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-refactoring-rule%29%29" class="RktStxLink" data-pltdoc="x">define-refactoring-rule</a></span> is usually enough for Resyntax to handle
commented code without issue, but in certain cases more precise control is desired. For instance,
consider the <span class="RktSym">nested-or-to-flat-or</span> rule from earlier:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-refactoring-rule%29%29" class="RktStxLink" data-pltdoc="x">define-refactoring-rule</a></span><span class="hspace">&nbsp;</span><span class="RktSym">nested-or-to-flat-or</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:description</span><span class="hspace">&nbsp;</span><span class="RktVal">"This nested `or` expression can be flattened."</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:literals</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>As-is, this rule will <span class="emph">fail</span> to refactor the following code:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">foo</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">If that doesn&rsquo;t work, fall back to other approaches</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bar</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">baz</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Resyntax rejects the rule because applying it would produce this code, which loses the comment:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">foo</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bar</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">baz</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Resyntax is unable to preserve the comment automatically. Resyntax can preserve some comments without
programmer effort, but only in specific circumstances:</p><ul><li><p>Comments <span class="emph">within</span> expressions that the rule left unchanged are preserved. If the comment
were inside <span class="RktPn">(</span><span class="RktSym">foo</span><span class="stt"> </span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span>, <span class="RktPn">(</span><span class="RktSym">bar</span><span class="stt"> </span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span>, or <span class="RktPn">(</span><span class="RktSym">baz</span><span class="stt"> </span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span>, it would have been kept.</p></li><li><p>Comments <span class="emph">between</span> unchanged expressions are similarly preserved. If the comment were
between <span class="RktPn">(</span><span class="RktSym">bar</span><span class="stt"> </span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span> and <span class="RktPn">(</span><span class="RktSym">baz</span><span class="stt"> </span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span>, it would have been kept.</p></li></ul><p>To fix this issue, rule authors can inject some extra markup into their suggested replacements using
<font class="badlink"><span class="techoutside"><span class="techinside">template metafunctions</span></span></font> provided by Resyntax. In
the case of <span class="RktSym">nested-or-to-flat-or</span>, we can use the <span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7esplicing-replacement%29%29" class="RktStxLink" data-pltdoc="x">~splicing-replacement</a></span>
metafunction to indicate that the nested <span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span> expression should be considered <span class="emph">replaced</span>
by its nested subterms:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-refactoring-rule%29%29" class="RktStxLink" data-pltdoc="x">define-refactoring-rule</a></span><span class="hspace">&nbsp;</span><span class="RktSym">nested-or-to-flat-or</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:description</span><span class="hspace">&nbsp;</span><span class="RktVal">"This nested `or` expression can be flattened."</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:literals</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">~and</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">nested-or</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:with</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">nested-subterm</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7esplicing-replacement%29%29" class="RktStxLink" data-pltdoc="x">~splicing-replacement</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">#:original</span><span class="hspace">&nbsp;</span><span class="RktSym">nested-or</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">nested-subterm</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>This adds <font class="badlink"><span class="techoutside"><span class="techinside">syntax properties</span></span></font> to the nested
subterms that allow Resyntax to preserve the comment, producing this output:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">foo</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">If that doesn&rsquo;t work, fall back to other approaches</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">bar</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">baz</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>When Resyntax sees that the <span class="RktPn">(</span><span class="RktSym">bar</span><span class="stt"> </span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span> nested subterm comes immediately after the
<span class="RktPn">(</span><span class="RktSym">foo</span><span class="stt"> </span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span> subterm, it notices that <span class="RktPn">(</span><span class="RktSym">bar</span><span class="stt"> </span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span> has been annotated with replacement
properties. Then Resyntax observes that <span class="RktPn">(</span><span class="RktSym">bar</span><span class="stt"> </span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span> is the first expression of a sequence of
expressions that replaces the <span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span> expression which originally followed <span class="RktPn">(</span><span class="RktSym">foo</span><span class="stt"> </span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span>.
Based on this observation, Resyntax decides to preserve whatever text was originally between
<span class="RktPn">(</span><span class="RktSym">foo</span><span class="stt"> </span><span class="RktSym"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span> and the nested <span class="RktSym"><span class="badlink"><span class="RktValLink">or</span></span></span> expression. This mechanism, exposed via
<span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7ereplacement%29%29" class="RktStxLink" data-pltdoc="x">~replacement</a></span> and <span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7esplicing-replacement%29%29" class="RktStxLink" data-pltdoc="x">~splicing-replacement</a></span>, offers a means for refactoring rules to
guide Resyntax&rsquo;s internal comment preservation system when the default behavior is not sufficient.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>template metafunction</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._resyntax/base..rkt)._~7ereplacement))"></a><span title="Provided from: resyntax/base | Package: resyntax"><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7ereplacement%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">~replacement</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">replacement-form</span><span class="hspace">&nbsp;</span><span class="RktVar">original</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">original</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:original</span><span class="hspace">&nbsp;</span><span class="RktVar">original-form</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:original-splice</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">original-form</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">A <font class="badlink"><span class="techoutside"><span class="techinside">template metafunction</span></span></font> for use in
<a href="file:///home/runner/work/resyntax/resyntax/main.html#%28tech._refactoring._rule%29" class="techoutside" data-pltdoc="x"><span class="techinside">refactoring rules</span></a>. The result of the metafunction is just the <span class="RktRdr">#'</span><span class="RktVar">replacement-form</span>
syntax object, except with some
<font class="badlink"><span class="techoutside"><span class="techinside">syntax properties</span></span></font> added. Those
properties inform Resyntax that this syntax object should be considered a replacement for
<span class="RktVar">original-form</span> (or in the splicing case, for the unparenthesized sequence
<span class="RktVar">original-form</span><span class="stt"> </span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span>). Resyntax uses this information to preserve comments and formatting near
the original form(s).</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>template metafunction</p></div></div><table cellspacing="0" cellpadding="0" class="RktBlk RForeground"><tr><td><span class="RktPn">(</span><a name="(form._((lib._resyntax/base..rkt)._~7esplicing-replacement))"></a><span title="Provided from: resyntax/base | Package: resyntax"><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7esplicing-replacement%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">~splicing-replacement</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">replacement-form</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVar">original</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="specgrammar"><tr><td align="right" valign="baseline"><span class="RktVar">original</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:original</span><span class="hspace">&nbsp;</span><span class="RktVar">original-form</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">#:original-splice</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">original-form</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">A <font class="badlink"><span class="techoutside"><span class="techinside">template metafunction</span></span></font> for use in
<a href="file:///home/runner/work/resyntax/resyntax/main.html#%28tech._refactoring._rule%29" class="techoutside" data-pltdoc="x"><span class="techinside">refactoring rules</span></a>. The result of the metafunction is the syntax object
<span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktVar">replacement-form</span><span class="stt"> </span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span><span class="RktPn">)</span>, except with some
<font class="badlink"><span class="techoutside"><span class="techinside">syntax properties</span></span></font> added. Those
properties inform Resyntax that the replacement syntax objects &#8212;<wbr></wbr> as an unparenthesized sequence &#8212;<wbr></wbr>
should be considered a replacement for <span class="RktVar">original-form</span> (or <span class="RktVar">original-form</span><span class="stt"> </span><span class="RktMeta"><span class="badlink"><span class="RktValLink">...</span></span></span>).
Resyntax uses this information to preserve comments and formatting near the original form(s).</div></p><h4 class="heading">3.2<tt>&nbsp;</tt><a name="(part._.Narrowing_the_.Focus_of_.Replacements)"></a>Narrowing the Focus of Replacements<span class="button-group"><a href="#(part._.Narrowing_the_.Focus_of_.Replacements)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>template metafunction</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._resyntax/base..rkt)._~7efocus-replacement-on))"></a><span title="Provided from: resyntax/base | Package: resyntax"><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._~7efocus-replacement-on%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">~focus-replacement-on</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">replacement-form</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A <font class="badlink"><span class="techoutside"><span class="techinside">template metafunction</span></span></font> for use in
<a href="file:///home/runner/work/resyntax/resyntax/main.html#%28tech._refactoring._rule%29" class="techoutside" data-pltdoc="x"><span class="techinside">refactoring rules</span></a>. The result of the metafunction is just the <span class="RktRdr">#'</span><span class="RktVar">replacement-form</span>
syntax object, except with some
<font class="badlink"><span class="techoutside"><span class="techinside">syntax properties</span></span></font> added. Those
properties inform Resyntax that the returned syntax object should be treated as the <span class="emph">focus</span> of
the entire refactoring rule&rsquo;s generated replacement. When a refactoring rule produces a replacement
that has a focus, Resyntax checks that nothing outside the focus was modified. If this is the case,
then Resyntax will <span class="emph">shrink</span> the replacement it generates to only touch the focus. Crucially,
this means Resyntax will <span class="emph">only reformat the focused code</span>, not the entire generated replacement.
This metafunction is frequently used with <span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28form._%28%28lib._resyntax%2Fbase..rkt%29._define-definition-context-refactoring-rule%29%29" class="RktStxLink" data-pltdoc="x">define-definition-context-refactoring-rule</a></span>,
because such rules often touch only a small series of forms in a much larger definition context.</div></p><h4 class="heading">3.3<tt>&nbsp;</tt><a name="(part._.Resyntax_s_.Default_.Rules)"></a><a name="(mod-path._resyntax/default-recommendations)"></a>Resyntax&rsquo;s Default Rules<span class="button-group"><a href="#(part._.Resyntax_s_.Default_.Rules)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left" colspan="2"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">require</span></span></span><span class="stt"> </span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28mod-path._resyntax%2Fdefault-recommendations%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">resyntax/default-recommendations</span></a><span class="RktPn">)</span></td></tr><tr><td align="left">&nbsp;</td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/resyntax" title="Install this package using `raco pkg install resyntax`"><span class="stt">resyntax</span></a></span></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._resyntax/default-recommendations..rkt)._default-recommendations))"></a><span title="Provided from: resyntax/default-recommendations | Package: resyntax"><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28def._%28%28lib._resyntax%2Fdefault-recommendations..rkt%29._default-recommendations%29%29" class="RktValDef RktValLink" data-pltdoc="x">default-recommendations</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28def._%28%28lib._resyntax%2Fbase..rkt%29._refactoring-suite~3f%29%29" class="RktValLink" data-pltdoc="x">refactoring-suite?</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">The refactoring suite containing all of Resyntax&rsquo;s default refactoring rules. These rules are further
broken up into subsuites, with each subsuite corresponding to a module within the
<a href="file:///home/runner/work/resyntax/resyntax/main.html#%28mod-path._resyntax%2Fdefault-recommendations%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">resyntax/default-recommendations</span></a> collection. For example, all of Resyntax&rsquo;s rules
related to <span class="RktSym"><span class="badlink"><span class="RktValLink">for</span></span></span> loops are located in the
<span class="RktMod">resyntax/default-recommendations/for-loop-shortcuts</span> module. See
<a href="https://github.com/jackfirth/resyntax/tree/master/default-recommendations">this directory</a> for all of Resyntax&rsquo;s default
refactoring rules.</div></p><h4 class="heading">3.4<tt>&nbsp;</tt><a name="(part._.What_.Makes_a_.Good_.Refactoring_.Rule_)"></a>What Makes a Good Refactoring Rule?<span class="button-group"><a href="#(part._.What_.Makes_a_.Good_.Refactoring_.Rule_)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>If you&rsquo;d like to add a new <a href="file:///home/runner/work/resyntax/resyntax/main.html#%28tech._refactoring._rule%29" class="techoutside" data-pltdoc="x"><span class="techinside">refactoring rule</span></a> to Resyntax, there are a few guidelines to keep in
mind:</p><ul><li><p>Refactoring rules should be <span class="emph">safe</span>. Resyntax shouldn&rsquo;t break users&rsquo; code, and it shouldn&rsquo;t
require careful review to determine whether a suggestion from Resyntax is safe to apply. It&rsquo;s better
for a rule to never make suggestions than to occasionally make broken suggestions.</p></li><li><p>Refactoring rules can be shown to many different developers in a wide variety of different
contexts. Therefore, it&rsquo;s important that Resyntax&rsquo;s default recommendations have some degree of
<span class="emph">consensus</span> among the Racket community. Highly divisive suggestions that many developers
disagree with are not a good fit for Resyntax. Technology is social before it is technical:
discussing your rule with the Racket community prior to developing it is encouraged, especially if
it&rsquo;s likely to affect a lot of code. If necessary, consider narrowing the focus of your rule to just
the cases that everybody agrees are clear improvements.</p></li><li><p>Refactoring rules should <span class="emph">explain themselves</span>. The description of a refactoring rule (as
specified with the <span class="RktPn">#:description</span> option) should state why the new code is an improvement
over the old code. Refactoring rule descriptions are shown to Resyntax users at the command line, in
GitHub pull request review comments, and in Git commit messages. The description is the only means
you have of explaining to a potentially confused stranger why Resyntax wants to change their code,
so make sure you use it!</p></li><li><p>Refactoring rules should focus on cleaning up <span class="emph">real-world code</span>. A refactoring rule that
suggests improvements to hypothetical code that no human would write in the first place is not
useful. Try to find examples of code "in the wild" that the rule would improve. The best candidates
for new rules tend to be rules that help Racketeers clean up and migrate old Scheme code that
doesn&rsquo;t take advantage of Racket&rsquo;s unique features and extensive standard library.</p></li><li><p>Refactoring rules should try to preserve the <span class="emph">intended behavior</span> of the refactored code,
but not necessarily the <span class="emph">actual behavior</span>. For instance, a rule that changes how code handles
some edge case is acceptable if the original behavior of the code was likely confusing or surprising
to the developer who wrote it. This is a judgment call that requires understanding what the original
code communicates clearly and what it doesn&rsquo;t. A rule&rsquo;s <span class="RktPn">#:description</span> is an excellent place
to draw attention to potentially surprising behavior changes.</p></li><li><p>Refactoring rules should be <span class="emph">self-contained</span>, meaning they can operate locally on a single
expression. Refactoring rules that require whole-program analysis are not a good fit for Resyntax,
nor are rules that require global knowledge of the whole codebase.</p></li></ul><h3 class="heading">4<tt>&nbsp;</tt><a name="(part._.Testing_.Refactoring_.Rules)"></a><a name="(mod-path._resyntax/test)"></a>Testing Refactoring Rules<span class="button-group"><a href="#(part._.Testing_.Refactoring_.Rules)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">require</span></span></span><span class="stt"> </span><a href="file:///home/runner/work/resyntax/resyntax/main.html#%28mod-path._resyntax%2Ftest%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">resyntax/test</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/resyntax" title="Install this package using `raco pkg install resyntax`"><span class="stt">resyntax</span></a></span></td></tr></table></p><p>Testing <a href="file:///home/runner/work/resyntax/resyntax/main.html#%28tech._refactoring._rule%29" class="techoutside" data-pltdoc="x"><span class="techinside">refactoring rules</span></a> is crucial to ensure they work correctly and safely. Resyntax provides
a domain-specific testing language called <a href="file:///home/runner/work/resyntax/resyntax/main.html#%28mod-path._resyntax%2Ftest%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">resyntax/test</span></a> that makes it easy to write
comprehensive tests for refactoring rules. This language is designed specifically for testing code
transformations and provides a clean, readable syntax for specifying before-and-after code examples.</p><h4 class="heading">4.1<tt>&nbsp;</tt><a name="(part._.Basic_.Test_.Structure)"></a>Basic Test Structure<span class="button-group"><a href="#(part._.Basic_.Test_.Structure)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>The basic structure of a test file is:</p><ol><li><p>Start with <span class="RktPn">#&lt;procedure:hash-lang&gt;</span><span class="stt"> </span><span class="RktPn">[</span><span class="RktPn">]</span><span class="stt"> </span><span class="RktSym">resyntax/test</span></p></li><li><p>Use <span class="RktSym">require:</span> to import the refactoring suite to test</p></li><li><p>Use <span class="RktSym">header:</span> to specify common code for all tests</p></li><li><p>Use <span class="RktSym">test:</span> to define individual test cases</p></li></ol><p>Here&rsquo;s an example:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">header:</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym"><span class="badlink"><span class="RktValLink">-</span></span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktMeta">#lang</span><span class="hspace">&nbsp;</span><span class="RktMeta">racket/base</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">test:</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"description</span><span class="hspace">&nbsp;</span><span class="RktVal">of</span><span class="hspace">&nbsp;</span><span class="RktVal">what</span><span class="hspace">&nbsp;</span><span class="RktVal">is</span><span class="hspace">&nbsp;</span><span class="RktVal">being</span><span class="hspace">&nbsp;</span><span class="RktVal">tested"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym"><span class="nobreak">------------------------------</span></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">original</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">code</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">here</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym"><span class="nobreak">------------------------------</span></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym"><span class="nobreak">------------------------------</span></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">expected</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">refactored</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">code</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">here</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym"><span class="nobreak">------------------------------</span></span><span class="RktMeta"></span></td></tr></table></blockquote><p>The main components are:</p><ul><li><p><span class="RktSym">require:</span> &#8212;<wbr></wbr> Imports a refactoring suite to test. The <span class="RktSym">module-name</span> specifies
where the suite is defined, and <span class="RktSym">suite-name</span> is the identifier of the suite.</p></li><li><p><span class="RktSym">header:</span> &#8212;<wbr></wbr> Specifies a code block that will be prepended to all test cases. This
typically contains <span class="RktPn">(</span><span class="RktSym">hash-lang</span><span class="RktPn">)</span> declarations and any necessary <span class="RktSym"><span class="badlink"><span class="RktValLink">require</span></span></span> statements.</p></li><li><p><span class="RktSym">test:</span> &#8212;<wbr></wbr> Defines a test case with a description. Test cases can specify either code
that should be refactored or code that should not be refactored.</p></li></ul><h4 class="heading">4.2<tt>&nbsp;</tt><a name="(part._.Test_.Case_.Types)"></a>Test Case Types<span class="button-group"><a href="#(part._.Test_.Case_.Types)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>There are two types of test cases you can write:</p><h5 class="heading">4.2.1<tt>&nbsp;</tt><a name="(part._.Positive_.Test_.Cases__.Code_.That_.Should_.Be_.Refactored_)"></a>Positive Test Cases (Code That Should Be Refactored)<span class="button-group"><a href="#(part._.Positive_.Test_.Cases__.Code_.That_.Should_.Be_.Refactored_)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>Positive test cases specify code that should be transformed by the refactoring rules. They consist of
two code blocks separated by a line of dashes:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">test: "lambda variable definition to function definition"</span></p></td></tr><tr><td><p><span class="stt">------------------------------</span></p></td></tr><tr><td><p><span class="stt">(define f</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(&#955; (a b c)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">1))</span></p></td></tr><tr><td><p><span class="stt">------------------------------</span></p></td></tr><tr><td><p><span class="stt">------------------------------</span></p></td></tr><tr><td><p><span class="stt">(define (f a b c)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">1)</span></p></td></tr><tr><td><p><span class="stt">------------------------------</span></p></td></tr></table></p><h5 class="heading">4.2.2<tt>&nbsp;</tt><a name="(part._.Negative_.Test_.Cases__.Code_.That_.Should_.Not_.Be_.Refactored_)"></a>Negative Test Cases (Code That Should Not Be Refactored)<span class="button-group"><a href="#(part._.Negative_.Test_.Cases__.Code_.That_.Should_.Not_.Be_.Refactored_)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>Negative test cases specify code that should be left unchanged by the refactoring rules. They consist
of a single code block:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">test: "class lambda variable definition not refactorable"</span></p></td></tr><tr><td><p><span class="stt">------------------------------</span></p></td></tr><tr><td><p><span class="stt">(require racket/class)</span></p></td></tr><tr><td><p><span class="stt">(class object%</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define f</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(&#955; (a b c)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">1)))</span></p></td></tr><tr><td><p><span class="stt">------------------------------</span></p></td></tr></table></p><h4 class="heading">4.3<tt>&nbsp;</tt><a name="(part._.Test_.Options)"></a>Test Options<span class="button-group"><a href="#(part._.Test_.Options)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>Test cases can include options that modify how the test is executed:</p><h5 class="heading">4.3.1<tt>&nbsp;</tt><a name="(part._.Line_.Range_.Restrictions)"></a>Line Range Restrictions<span class="button-group"><a href="#(part._.Line_.Range_.Restrictions)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>The <span class="RktSym">lines</span> option restricts refactoring to specific line ranges, which is useful for testing
that rules only affect the intended parts of multi-definition code:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">test: "refactoring respects requested line range"</span></p></td></tr><tr><td><p><span class="stt">@lines 2..3</span></p></td></tr><tr><td><p><span class="stt">------------------------------</span></p></td></tr><tr><td><p><span class="stt">(define (foo)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define-values (a b c)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(values 1 2 3))</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(+ a b c))</span></p></td></tr><tr><td><p><span class="stt">(define (bar)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define-values (x y z)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(values 4 5 6))</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(+ x y z))</span></p></td></tr><tr><td><p><span class="stt">------------------------------</span></p></td></tr><tr><td><p><span class="stt">------------------------------</span></p></td></tr><tr><td><p><span class="stt">(define (foo)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define a 1)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define b 2)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define c 3)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(+ a b c))</span></p></td></tr><tr><td><p><span class="stt">(define (bar)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(define-values (x y z)</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">(values 4 5 6))</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">(+ x y z))</span></p></td></tr><tr><td><p><span class="stt">------------------------------</span></p></td></tr></table></p><p>Line ranges use the syntax <span class="RktSym">start..end</span> where <span class="RktSym">start</span> and <span class="RktSym">end</span> are line numbers
(starting from 1). Multiple ranges can be specified by separating them with commas.</p><h4 class="heading">4.4<tt>&nbsp;</tt><a name="(part._.Writing_.Effective_.Tests)"></a>Writing Effective Tests<span class="button-group"><a href="#(part._.Writing_.Effective_.Tests)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>When writing tests for refactoring rules, consider these guidelines:</p><ul><li><p><span class="emph">Test both positive and negative cases</span> &#8212;<wbr></wbr> Include tests for code that should be
refactored and code that should be left alone. This ensures your rules are neither too aggressive
nor too conservative.</p></li><li><p><span class="emph">Test edge cases</span> &#8212;<wbr></wbr> Include tests for unusual or borderline cases, such as nested
expressions, complex argument lists, or interactions with other language features.</p></li><li><p><span class="emph">Use descriptive test names</span> &#8212;<wbr></wbr> Test descriptions should clearly explain what is being
tested and why. This makes it easier to understand test failures and maintain the test suite.</p></li><li><p><span class="emph">Test formatting preservation</span> &#8212;<wbr></wbr> Include tests that verify your rules preserve code
formatting and comments appropriately. Resyntax aims to make minimal changes to code structure.</p></li><li><p><span class="emph">Test line range restrictions</span> &#8212;<wbr></wbr> If your rule might be applied to part of a file,
include tests with <span class="RktSym">lines</span> options to ensure it behaves correctly in that context.</p></li></ul><h4 class="heading">4.5<tt>&nbsp;</tt><a name="(part._.Running_.Tests)"></a>Running Tests<span class="button-group"><a href="#(part._.Running_.Tests)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>Tests can be run using Racket&rsquo;s standard testing tools:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">raco test my-rule-test.rkt</span></p></td></tr></table></p><p>This will execute all test cases in the file and report any failures. Test failures typically indicate
that a refactoring rule is not behaving as expected and needs to be fixed.</p></div></div><div id="contextindicator">&nbsp;</div></body></html>