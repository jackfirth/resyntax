<html><head><meta charset="utf-8"/><link rel="stylesheet" type="text/css" href="../../../assets/main.css"/></head><body><p>expr: 100%<br/></p><div class="code"><div class="lines-wrapper"><div class="line-numbers"><div><a href="#1">1</a></div><div><a href="#2">2</a></div><div><a href="#3">3</a></div><div><a href="#4">4</a></div><div><a href="#5">5</a></div><div><a href="#6">6</a></div><div><a href="#7">7</a></div><div><a href="#8">8</a></div><div><a href="#9">9</a></div><div><a href="#10">10</a></div><div><a href="#11">11</a></div><div><a href="#12">12</a></div><div><a href="#13">13</a></div><div><a href="#14">14</a></div><div><a href="#15">15</a></div><div><a href="#16">16</a></div><div><a href="#17">17</a></div><div><a href="#18">18</a></div><div><a href="#19">19</a></div><div><a href="#20">20</a></div><div><a href="#21">21</a></div><div><a href="#22">22</a></div><div><a href="#23">23</a></div><div><a href="#24">24</a></div><div><a href="#25">25</a></div><div><a href="#26">26</a></div><div><a href="#27">27</a></div><div><a href="#28">28</a></div><div><a href="#29">29</a></div><div><a href="#30">30</a></div><div><a href="#31">31</a></div><div><a href="#32">32</a></div><div><a href="#33">33</a></div><div><a href="#34">34</a></div><div><a href="#35">35</a></div><div><a href="#36">36</a></div><div><a href="#37">37</a></div><div><a href="#38">38</a></div><div><a href="#39">39</a></div><div><a href="#40">40</a></div><div><a href="#41">41</a></div><div><a href="#42">42</a></div><div><a href="#43">43</a></div><div><a href="#44">44</a></div></div><div class="file-lines"><div class="line" id="1"><span class="irrelevant">#lang</span>&nbsp;<span class="covered">racket/base</span></div><br id="2"/><br id="3"/><div class="line" id="4"><span class="covered">(provide</span>&nbsp;<span class="covered">worthwhile-loop-body-function)</span></div><br id="5"/><br id="6"/><div class="line" id="7"><span class="covered">(require</span>&nbsp;<span class="covered">resyntax/default-recommendations/private/lambda-by-any-name</span></div><div class="line" id="8">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="covered">resyntax/default-recommendations/let-replacement/private/let-binding</span></div><div class="line" id="9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="covered">syntax/parse)</span></div><br id="10"/><br id="11"/><div class="line" id="12"><span class="irrelevant">;@----------------------------------------------------------------------------------------------------</span></div><br id="13"/><br id="14"/><div class="line" id="15"><span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">A</span>&nbsp;<span class="irrelevant">loop</span>&nbsp;<span class="irrelevant">body</span>&nbsp;<span class="irrelevant">function</span>&nbsp;<span class="irrelevant">is</span>&nbsp;<span class="irrelevant">a</span>&nbsp;<span class="irrelevant">lambda</span>&nbsp;<span class="irrelevant">expression</span>&nbsp;<span class="irrelevant">that</span>&nbsp;<span class="irrelevant">is</span>&nbsp;<span class="irrelevant">passed</span>&nbsp;<span class="irrelevant">to</span>&nbsp;<span class="irrelevant">a</span>&nbsp;<span class="irrelevant">function</span>&nbsp;<span class="irrelevant">like</span>&nbsp;<span class="irrelevant">map,</span>&nbsp;<span class="irrelevant">for-each,</span>&nbsp;<span class="irrelevant">or</span></div><div class="line" id="16"><span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">ormap</span>&nbsp;<span class="irrelevant">which</span>&nbsp;<span class="irrelevant">calls</span>&nbsp;<span class="irrelevant">the</span>&nbsp;<span class="irrelevant">lambda</span>&nbsp;<span class="irrelevant">once</span>&nbsp;<span class="irrelevant">for</span>&nbsp;<span class="irrelevant">each</span>&nbsp;<span class="irrelevant">element</span>&nbsp;<span class="irrelevant">of</span>&nbsp;<span class="irrelevant">a</span>&nbsp;<span class="irrelevant">list.</span>&nbsp;<span class="irrelevant">When</span>&nbsp;<span class="irrelevant">code</span>&nbsp;<span class="irrelevant">is</span>&nbsp;<span class="irrelevant">migrated</span>&nbsp;<span class="irrelevant">to</span>&nbsp;<span class="irrelevant">use</span>&nbsp;<span class="irrelevant">for</span></div><div class="line" id="17"><span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">loops,</span>&nbsp;<span class="irrelevant">the</span>&nbsp;<span class="irrelevant">loop</span>&nbsp;<span class="irrelevant">body</span>&nbsp;<span class="irrelevant">function</span>&nbsp;<span class="irrelevant">becomes</span>&nbsp;<span class="irrelevant">the</span>&nbsp;<span class="irrelevant">body</span>&nbsp;<span class="irrelevant">of</span>&nbsp;<span class="irrelevant">the</span>&nbsp;<span class="irrelevant">for</span>&nbsp;<span class="irrelevant">loop,</span>&nbsp;<span class="irrelevant">hence</span>&nbsp;<span class="irrelevant">the</span>&nbsp;<span class="irrelevant">name.</span>&nbsp;<span class="irrelevant">For</span>&nbsp;<span class="irrelevant">convenience,</span></div><div class="line" id="18"><span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">we</span>&nbsp;<span class="irrelevant">also</span>&nbsp;<span class="irrelevant">accept</span>&nbsp;<span class="irrelevant">lambdas</span>&nbsp;<span class="irrelevant">which</span>&nbsp;<span class="irrelevant">take</span>&nbsp;<span class="irrelevant">two</span>&nbsp;<span class="irrelevant">arguments</span>&nbsp;<span class="irrelevant">such</span>&nbsp;<span class="irrelevant">as</span>&nbsp;<span class="irrelevant">those</span>&nbsp;<span class="irrelevant">used</span>&nbsp;<span class="irrelevant">with</span>&nbsp;<span class="irrelevant">hash-for-each.</span>&nbsp;<span class="irrelevant">Techncially,</span></div><div class="line" id="19"><span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">such</span>&nbsp;<span class="irrelevant">a</span>&nbsp;<span class="irrelevant">two-argument</span>&nbsp;<span class="irrelevant">lambda</span>&nbsp;<span class="irrelevant">shouldn't</span>&nbsp;<span class="irrelevant">be</span>&nbsp;<span class="irrelevant">accepted</span>&nbsp;<span class="irrelevant">when</span>&nbsp;<span class="irrelevant">in</span>&nbsp;<span class="irrelevant">the</span>&nbsp;<span class="irrelevant">context</span>&nbsp;<span class="irrelevant">of</span>&nbsp;<span class="irrelevant">a</span>&nbsp;<span class="irrelevant">function</span>&nbsp;<span class="irrelevant">like</span>&nbsp;<span class="irrelevant">for-each</span></div><div class="line" id="20"><span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">instead</span>&nbsp;<span class="irrelevant">of</span>&nbsp;<span class="irrelevant">hash-for-each,</span>&nbsp;<span class="irrelevant">but</span>&nbsp;<span class="irrelevant">we</span>&nbsp;<span class="irrelevant">don't</span>&nbsp;<span class="irrelevant">bother</span>&nbsp;<span class="irrelevant">checking</span>&nbsp;<span class="irrelevant">for</span>&nbsp;<span class="irrelevant">that</span>&nbsp;<span class="irrelevant">since</span>&nbsp;<span class="irrelevant">if</span>&nbsp;<span class="irrelevant">the</span>&nbsp;<span class="irrelevant">code</span>&nbsp;<span class="irrelevant">already</span>&nbsp;<span class="irrelevant">compiles</span></div><div class="line" id="21"><span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">and</span>&nbsp;<span class="irrelevant">runs</span>&nbsp;<span class="irrelevant">without</span>&nbsp;<span class="irrelevant">any</span>&nbsp;<span class="irrelevant">tests</span>&nbsp;<span class="irrelevant">failing</span>&nbsp;<span class="irrelevant">it</span>&nbsp;<span class="irrelevant">probably</span>&nbsp;<span class="irrelevant">doesn't</span>&nbsp;<span class="irrelevant">have</span>&nbsp;<span class="irrelevant">that</span>&nbsp;<span class="irrelevant">issue.</span></div><div class="line" id="22"><span class="covered">(define-syntax-class</span>&nbsp;<span class="covered">worthwhile-loop-body-function</span></div><div class="line" id="23">&nbsp;&nbsp;<span class="covered">#:attributes</span>&nbsp;<span class="covered">(x</span>&nbsp;<span class="covered">y</span>&nbsp;<span class="covered">[body</span>&nbsp;<span class="covered">1])</span></div><br id="24"/><div class="line" id="25">&nbsp;&nbsp;<span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">We</span>&nbsp;<span class="irrelevant">always</span>&nbsp;<span class="irrelevant">migrate</span>&nbsp;<span class="irrelevant">loop</span>&nbsp;<span class="irrelevant">functions</span>&nbsp;<span class="irrelevant">that</span>&nbsp;<span class="irrelevant">use</span>&nbsp;<span class="irrelevant">let</span>&nbsp;<span class="irrelevant">expressions,</span>&nbsp;<span class="irrelevant">since</span>&nbsp;<span class="irrelevant">in</span>&nbsp;<span class="irrelevant">the</span>&nbsp;<span class="irrelevant">process</span>&nbsp;<span class="irrelevant">of</span>&nbsp;<span class="irrelevant">migrating</span></div><div class="line" id="26">&nbsp;&nbsp;<span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">we</span>&nbsp;<span class="irrelevant">can</span>&nbsp;<span class="irrelevant">replace</span>&nbsp;<span class="irrelevant">the</span>&nbsp;<span class="irrelevant">let</span>&nbsp;<span class="irrelevant">bindings</span>&nbsp;<span class="irrelevant">with</span>&nbsp;<span class="irrelevant">internal</span>&nbsp;<span class="irrelevant">definitions</span>&nbsp;<span class="irrelevant">within</span>&nbsp;<span class="irrelevant">the</span>&nbsp;<span class="irrelevant">for</span>&nbsp;<span class="irrelevant">loop</span>&nbsp;<span class="irrelevant">body.</span></div><div class="line" id="27">&nbsp;&nbsp;<span class="covered">(pattern</span></div><div class="line" id="28">&nbsp;&nbsp;&nbsp;&nbsp;<span class="covered">(_:lambda-by-any-name</span>&nbsp;<span class="covered">(x</span>&nbsp;<span class="covered">(~optional</span>&nbsp;<span class="covered">(~seq</span>&nbsp;<span class="covered">y)))</span></div><div class="line" id="29">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="covered">original-body:body-with-refactorable-let-expression)</span></div><div class="line" id="30">&nbsp;&nbsp;&nbsp;&nbsp;<span class="covered">#:with</span>&nbsp;<span class="covered">(body</span>&nbsp;<span class="covered">...)</span>&nbsp;<span class="covered">#'(original-body.refactored</span>&nbsp;<span class="covered">...))</span></div><br id="31"/><div class="line" id="32">&nbsp;&nbsp;<span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">Lambdas</span>&nbsp;<span class="irrelevant">with</span>&nbsp;<span class="irrelevant">multiple</span>&nbsp;<span class="irrelevant">body</span>&nbsp;<span class="irrelevant">forms</span>&nbsp;<span class="irrelevant">are</span>&nbsp;<span class="irrelevant">hard</span>&nbsp;<span class="irrelevant">to</span>&nbsp;<span class="irrelevant">read</span>&nbsp;<span class="irrelevant">when</span>&nbsp;<span class="irrelevant">all</span>&nbsp;<span class="irrelevant">the</span>&nbsp;<span class="irrelevant">forms</span>&nbsp;<span class="irrelevant">are</span>&nbsp;<span class="irrelevant">on</span>&nbsp;<span class="irrelevant">one</span>&nbsp;<span class="irrelevant">line,</span>&nbsp;<span class="irrelevant">so</span>&nbsp;<span class="irrelevant">we</span></div><div class="line" id="33">&nbsp;&nbsp;<span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">assume</span>&nbsp;<span class="irrelevant">all</span>&nbsp;<span class="irrelevant">such</span>&nbsp;<span class="irrelevant">lambdas</span>&nbsp;<span class="irrelevant">are</span>&nbsp;<span class="irrelevant">multi-line,</span>&nbsp;<span class="irrelevant">and</span>&nbsp;<span class="irrelevant">multi-line</span>&nbsp;<span class="irrelevant">for-each</span>&nbsp;<span class="irrelevant">functions</span>&nbsp;<span class="irrelevant">are</span>&nbsp;<span class="irrelevant">typically</span>&nbsp;<span class="irrelevant">easier</span></div><div class="line" id="34">&nbsp;&nbsp;<span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">to</span>&nbsp;<span class="irrelevant">read</span>&nbsp;<span class="irrelevant">when</span>&nbsp;<span class="irrelevant">they're</span>&nbsp;<span class="irrelevant">in</span>&nbsp;<span class="irrelevant">the</span>&nbsp;<span class="irrelevant">body</span>&nbsp;<span class="irrelevant">of</span>&nbsp;<span class="irrelevant">a</span>&nbsp;<span class="irrelevant">for</span>&nbsp;<span class="irrelevant">loop.</span></div><div class="line" id="35">&nbsp;&nbsp;<span class="covered">(pattern</span>&nbsp;<span class="covered">(_:lambda-by-any-name</span>&nbsp;<span class="covered">(x</span>&nbsp;<span class="covered">(~optional</span>&nbsp;<span class="covered">(~seq</span>&nbsp;<span class="covered">y)))</span>&nbsp;<span class="covered">first-body</span>&nbsp;<span class="covered">remaining-body</span>&nbsp;<span class="covered">...+)</span></div><div class="line" id="36">&nbsp;&nbsp;&nbsp;&nbsp;<span class="covered">#:with</span>&nbsp;<span class="covered">(body</span>&nbsp;<span class="covered">...)</span>&nbsp;<span class="covered">#'(first-body</span>&nbsp;<span class="covered">remaining-body</span>&nbsp;<span class="covered">...))</span></div><br id="37"/><div class="line" id="38">&nbsp;&nbsp;<span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">We</span>&nbsp;<span class="irrelevant">don't</span>&nbsp;<span class="irrelevant">bother</span>&nbsp;<span class="irrelevant">migrating</span>&nbsp;<span class="irrelevant">for-each</span>&nbsp;<span class="irrelevant">forms</span>&nbsp;<span class="irrelevant">with</span>&nbsp;<span class="irrelevant">only</span>&nbsp;<span class="irrelevant">a</span>&nbsp;<span class="irrelevant">single</span>&nbsp;<span class="irrelevant">body</span>&nbsp;<span class="irrelevant">form</span>&nbsp;<span class="irrelevant">unless</span>&nbsp;<span class="irrelevant">the</span>&nbsp;<span class="irrelevant">body</span>&nbsp;<span class="irrelevant">form</span>&nbsp;<span class="irrelevant">is</span></div><div class="line" id="39">&nbsp;&nbsp;<span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">exceptionally</span>&nbsp;<span class="irrelevant">long,</span>&nbsp;<span class="irrelevant">so</span>&nbsp;<span class="irrelevant">that</span>&nbsp;<span class="irrelevant">forms</span>&nbsp;<span class="irrelevant">which</span>&nbsp;<span class="irrelevant">span</span>&nbsp;<span class="irrelevant">multiple</span>&nbsp;<span class="irrelevant">lines</span>&nbsp;<span class="irrelevant">tend</span>&nbsp;<span class="irrelevant">to</span>&nbsp;<span class="irrelevant">get</span>&nbsp;<span class="irrelevant">migrated.</span>&nbsp;<span class="irrelevant">By</span>&nbsp;<span class="irrelevant">not</span></div><div class="line" id="40">&nbsp;&nbsp;<span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">migrating</span>&nbsp;<span class="irrelevant">short</span>&nbsp;<span class="irrelevant">forms,</span>&nbsp;<span class="irrelevant">we</span>&nbsp;<span class="irrelevant">avoid</span>&nbsp;<span class="irrelevant">bothering</span>&nbsp;<span class="irrelevant">reviewers</span>&nbsp;<span class="irrelevant">with</span>&nbsp;<span class="irrelevant">changes</span>&nbsp;<span class="irrelevant">to</span>&nbsp;<span class="irrelevant">loops</span>&nbsp;<span class="irrelevant">that</span>&nbsp;<span class="irrelevant">aren't</span>&nbsp;<span class="irrelevant">complex</span></div><div class="line" id="41">&nbsp;&nbsp;<span class="irrelevant">;;</span>&nbsp;<span class="irrelevant">enough</span>&nbsp;<span class="irrelevant">to</span>&nbsp;<span class="irrelevant">need</span>&nbsp;<span class="irrelevant">a</span>&nbsp;<span class="irrelevant">lot</span>&nbsp;<span class="irrelevant">of</span>&nbsp;<span class="irrelevant">refactoring</span>&nbsp;<span class="irrelevant">in</span>&nbsp;<span class="irrelevant">the</span>&nbsp;<span class="irrelevant">first</span>&nbsp;<span class="irrelevant">place.</span></div><div class="line" id="42">&nbsp;&nbsp;<span class="covered">(pattern</span>&nbsp;<span class="covered">(_:lambda-by-any-name</span>&nbsp;<span class="covered">(x</span>&nbsp;<span class="covered">(~optional</span>&nbsp;<span class="covered">(~seq</span>&nbsp;<span class="covered">y)))</span>&nbsp;<span class="covered">only-body)</span></div><div class="line" id="43">&nbsp;&nbsp;&nbsp;&nbsp;<span class="covered">#:when</span>&nbsp;<span class="covered">(&gt;=</span>&nbsp;<span class="covered">(syntax-span</span>&nbsp;<span class="covered">#'only-body)</span>&nbsp;<span class="covered">60)</span></div><div class="line" id="44">&nbsp;&nbsp;&nbsp;&nbsp;<span class="covered">#:with</span>&nbsp;<span class="covered">(body</span>&nbsp;<span class="covered">...)</span>&nbsp;<span class="covered">#'(only-body)))</span></div></div></div></div></body></html>